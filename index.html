<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malka Jurnal</title>
    <meta name="description" content="Portal Malka Jurnal - Akses cepat ke Jurnal Mengajar, Daftar Hadir, dan Rekapitulasi SMKN 1 Plosoklaten.">
    <link rel="icon" href="https://smkn1plosoklaten.sch.id/img/logo-smk.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@700&display=swap" rel="stylesheet">

    <!-- SDK Firebase (Modular SDK) -->
    <script type="module">
        // Import the functions you need from Firebase SDK v9
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCnwDpcZnAn_DzbA6l0ACrAGmyaDzguLEQ",
          authDomain: "malka-jurnal.firebaseapp.com",
          projectId: "malka-jurnal",
          storageBucket: "malka-jurnal.firebasestorage.app",
          messagingSenderId: "801975799432",
          appId: "1:801975799432:web:bd7babdb91ebf36286193d",
          measurementId: "G-KRGW0JVXYX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Elements
        const loginPage = document.getElementById('login-page');
        const appContainer = document.getElementById('app-container');
        const btnGoogleLogin = document.getElementById('btn-google-login');
        const btnSignOut = document.getElementById('btn-sign-out');
        const userPhoto = document.getElementById('user-photo');
        const loginError = document.getElementById('login-error');
        const mainMenu = document.getElementById('main-menu');

        // Listen to auth state change
        auth.onAuthStateChanged(user => {
            if (user) {
                // User logged in
                appContainer.classList.remove('hidden');
                loginPage.classList.add('hidden');
                userPhoto.src = user.photoURL || 'https://placehold.co/40x40/FFFFFF/333333?text=?';
                showMainMenu();
            } else {
                // User logged out
                appContainer.classList.add('hidden');
                loginPage.classList.remove('hidden');
                userPhoto.src = '';
                document.querySelectorAll('.page-embed').forEach(page => {
                    page.classList.add('hidden');
                });
            }
        });

        // Google Sign-In
        btnGoogleLogin.addEventListener('click', () => {
            loginError.textContent = ''; // Clear previous error
            signInWithPopup(auth, provider)
                .then(result => {
                    console.log("Login successful:", result.user);
                })
                .catch(error => {
                    console.error("Error during sign-in:", error);
                    loginError.textContent = "Gagal login: " + error.message;
                });
        });

        // Google Sign-Out
        btnSignOut.addEventListener('click', () => {
            signOut(auth)
                .then(() => {
                    console.log("User signed out");
                })
                .catch((error) => {
                    console.error("Sign out error:", error);
                });
        });

        // Show main menu
        function showMainMenu() {
            mainMenu.classList.remove('hidden');
            document.querySelectorAll('.page-embed').forEach(page => {
                page.classList.add('hidden');
            });
        }

        // Show page based on button click
        const pageMap = {
            'btn-jurnal': 'page-jurnal',
            'btn-upacara': 'page-upacara',
            'btn-yasin': 'page-yasin',
            'btn-rekap-jurnal': 'page-rekap-jurnal',
            'btn-rekap-upacara': 'page-rekap-upacara',
            'btn-rekap-yasin': 'page-rekap-yasin'
        };

        function showPage(pageId) {
            mainMenu.classList.add('hidden');
            document.querySelectorAll('.page-embed').forEach(page => {
                page.classList.add('hidden');
            });
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.remove('hidden');
                window.scrollTo(0, 0);
            }
        }

        Object.keys(pageMap).forEach(buttonId => {
            const button = document.getElementById(buttonId);
            if (button) {
                button.addEventListener('click', () => {
                    showPage(pageMap[buttonId]);
                });
            }
        });

        document.querySelectorAll('.btn-kembali').forEach(button => {
            button.addEventListener('click', () => {
                const parentPage = button.closest('.page-embed');
                const iframe = parentPage.querySelector('iframe');
                if (iframe) {
                    const src = iframe.src;
                    iframe.src = null;  // Stop loading
                    iframe.src = src;   // Restart loading
                }
                showMainMenu();
            });
        });
    </script>
</head>
<body class="antialiased text-gray-900">

    <!-- ============================================== -->
    <!-- HALAMAN LOGIN (BARU) -->
    <!-- ============================================== -->
    <div id="login-page" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-8">
        <div class="bg-white/70 backdrop-blur-md p-8 sm:p-12 rounded-2xl shadow-2xl text-center max-w-sm w-full">
            <img src="https://smkn1plosoklaten.sch.id/img/logo-smk.png" alt="Logo SMKN 1 Plosoklaten" class="h-20 w-auto mx-auto mb-4">
            <h1 class="text-2xl sm:text-3xl font-bold tracking-wide font-serif text-gradient-gold mb-2" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.1); background-image: linear-gradient(to right, #0A4D68 0%, #086a8b 50%, #0A4D68 100%);">
                MALKA JURNAL
            </h1>
            <p class="text-gray-600 mb-8">Silakan login untuk melanjutkan.</p>

            <button id="btn-google-login" class="w-full bg-white text-gray-700 font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2">
                <svg class="w-6 h-6" viewBox="0 0 48 48">
                    <path fill="#4285F4" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                    <path fill="#34A853" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v8.51h12.8c-.57 2.73-2.24 5.08-4.79 6.69l7.98 6.19c4.63-4.26 7.27-10.3 7.27-17.01z"></path>
                    <path fill="#FBBC05" d="M10.53 28.59c-.49-1.45-.78-2.99-.78-4.59s.29-3.14.78-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                    <path fill="#EA4335" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.98-6.19c-2.11 1.43-4.79 2.2-7.91 2.2-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                </svg>
                <span>Sign in with Google</span>
            </button>
            <p id="login-error" class="text-red-500 text-sm mt-4"></p>
        </div>
    </div>

    <!-- ============================================== -->
    <!-- KONTEN APLIKASI UTAMA (Disembunyikan) -->
    <!-- ============================================== -->
    <!-- Wrapper ini akan 'hidden' sampai pengguna login -->
    <div id="app-container" class="hidden">

        <!-- Header Utama -->
        <header class="bg-gradient-to-r from-teal-600 to-cyan-700 shadow-lg p-4 fixed top-0 left-0 right-0 z-10">
            <div class="container mx-auto max-w-5xl flex justify-between items-center">
                <img src="https://smkn1plosoklaten.sch.id/img/logo-smk.png" alt="Logo SMKN 1 Plosoklaten" class="h-10 w-auto">
                <h1 class="text-xl sm:text-2xl font-bold tracking-wide font-serif text-gradient-gold">
                    MALKA JURNAL
                </h1>
                <div class="flex items-center space-x-3">
                    <img id="user-photo" src="" alt="Foto Profil" class="h-10 w-10 rounded-full border-2 border-white/50 object-cover">
                    <button id="btn-sign-out" class="text-white text-sm font-semibold bg-red-500/80 hover:bg-red-600 px-3 py-1.5 rounded-lg transition-colors">
                        Sign Out
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Menu -->
        <div id="main-menu">
            <main class="container mx-auto max-w-5xl p-4 sm:p-6">
                <div class="w-full h-48 sm:h-64 md:h-80 rounded-2xl shadow-inner overflow-hidden relative mb-6" style="background: linear-gradient(135deg, #0A4D68 0%, #086a8b 100%);">
                    <svg class="w-full h-full opacity-80" viewBox="0 0 300 150" preserveAspectRatio="xMidYMid slice">
                        <path id="cloud1" d="M 50 130 Q 40 110 60 110 Q 70 90 90 100 Q 110 90 120 110 Q 140 110 150 130 Z" fill="#FFFFFF" opacity="0.7"/>
                        <path id="cloud2" d="M 180 140 Q 170 120 190 120 Q 200 100 220 110 Q 240 100 250 120 Q 270 120 280 140 Z" fill="#FFFFFF" opacity="0.6"/>
                        <path d="M 70 80 Q 100 70 150 85 Q 200 100 230 80 L 235 95 Q 200 115 150 100 Q 100 85 75 95 Z" fill="#0A4D68" stroke="#000" stroke-width="0.5" opacity="0.8"/>
                    </svg>
                    <div class="absolute inset-0 flex items-start justify-center p-4 pt-4 sm:pt-6">
                        <h2 class="text-white text-lg sm:text-xl font-bold font-serif text-center">
                            Selamat Datang di MalkaJurnal
                        </h2>
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 sm:gap-6 relative">
                    <button id="btn-jurnal" class="shortcut-card group bg-white">
                        <svg class="w-16 h-16 sm:w-20 sm:h-20" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                            <!-- SVG for Jurnal Mengajar -->
                        </svg>
                        <h3>Jurnal Mengajar</h3>
                    </button>
                    <!-- Other buttons here -->
                </div>
            </main>
        </div>
    </div>

</body>
</html>
